<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Python+selenium爬取b站Top100数据</title>
    <link href="/2022/06/23/Python/"/>
    <url>/2022/06/23/Python/</url>
    
    <content type="html"><![CDATA[<h2 id="1-selenium库"><a href="#1-selenium库" class="headerlink" title="1.selenium库"></a>1.selenium库</h2><p>Selenium是一个用于Web应用程序测试的工具。Selenium测试直接运行在浏览器中，就像真正的用户在操作一样。支持的浏览器包括IE（7, 8, 9, 10, 11），Mozilla Firefox，Safari，Google Chrome，Opera，Edge等。这个工具的主要功能包括：测试与浏览器的兼容性——测试应用程序看是否能够很好得工作在不同浏览器和操作系统之上。测试系统功能——创建回归测试检验软件功能和用户需求。支持自动录制动作和自动生成.Net、Java、Perl等不同语言的测试脚本。</p><h2 id="2-selenium库的安装"><a href="#2-selenium库的安装" class="headerlink" title="2.selenium库的安装"></a>2.selenium库的安装</h2><p>在python中安装selenium库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ pip/pip3 install selenium<br></code></pre></td></tr></table></figure><h2 id="3-浏览器的驱动安装"><a href="#3-浏览器的驱动安装" class="headerlink" title="3.浏览器的驱动安装"></a>3.浏览器的驱动安装</h2><p>下载链接：<a href="https://chromedriver.storage.googleapis.com/index.html">浏览器驱动</a><br>我这里使用的是谷歌浏览器，点击链接，找到对应浏览器的相应版本安装，浏览器的设置——关于 可以查询浏览器的版本，下载解压之后得到一个exe文件，放到chrome浏览器的安装目录下即可</p><p>（我的目录路径是C:\Users\丑丑a\Downloads\chromedriver.exe）</p><p>测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">from selenium import webdriver<br>driver = webdriver.Chrome(executable_path=r<span class="hljs-string">&quot;C:\Users\丑丑a\Downloads\chromedriver.exe&quot;</span>)<br>driver.get(<span class="hljs-string">&quot;https://www.bilibili.com/v/popular/rank/all&quot;</span>)<br></code></pre></td></tr></table></figure><p>若能自动打开浏览器，即安装成功。</p><h3 id="4-完整代码"><a href="#4-完整代码" class="headerlink" title="4.完整代码"></a>4.完整代码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs bash">from selenium import webdriver<br>import time<br>import pandas as pd<br><br>def main():<br>    driver = webdriver.Chrome(executable_path=r<span class="hljs-string">&quot;C:\Users\丑丑a\Downloads\chromedriver.exe&quot;</span>)<br>    <span class="hljs-comment"># 声明爬取网站</span><br>    driver.get(<span class="hljs-string">&quot;https://www.bilibili.com/v/popular/rank/all&quot;</span>)<br><br>    Order = []  <span class="hljs-comment"># 榜单次序</span><br>    Title = []  <span class="hljs-comment"># 视频标题</span><br>    Up = []     <span class="hljs-comment"># 视频Up主</span><br>    Click = []   <span class="hljs-comment"># 视频点击量</span><br>    View = []   <span class="hljs-comment"># 视频评价数</span><br>    Link = []   <span class="hljs-comment"># 视频链接</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> driver.find_elements_by_xpath(<span class="hljs-string">&quot;/html/body/div/div/div/div/ul/li/div/div/i/span&quot;</span>):<br>        Order.append(i.text)<br>        <span class="hljs-comment"># print(i.text)</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> driver.find_elements_by_xpath(<span class="hljs-string">&quot;//div/ul/li/div/div/a&quot;</span>):<br>        <span class="hljs-keyword">if</span>(i.text != <span class="hljs-string">&quot;&quot;</span>):<br>            Title.append(i.text)<br>            <span class="hljs-comment"># print(i.text)</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> driver.find_elements_by_xpath(<span class="hljs-string">&quot;//*[@id=&#x27;app&#x27;]/div/div/div/ul/li/div/div/div/a/span&quot;</span>):<br>        Up.append(i.text)<br>        <span class="hljs-comment"># print(i.text)</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> driver.find_elements_by_xpath(<span class="hljs-string">&quot;//*[@id=&#x27;app&#x27;]/div/div/div/ul/li/div/div/div/div/span[1]&quot;</span>):<br>        Click.append(i.text)<br>        <span class="hljs-comment"># print(i.text)</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> driver.find_elements_by_xpath(<span class="hljs-string">&quot;//*[@id=&#x27;app&#x27;]/div/div/div/ul/li/div/div/div/div/span[2]&quot;</span>):<br>        View.append(i.text)<br>        <span class="hljs-comment"># print(i.text)</span><br><br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">link</span> <span class="hljs-keyword">in</span> driver.find_elements_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;app&quot;]/div/div/div/ul/li/div/div[2]/a&#x27;</span>):<br>        a = link.get_attribute(<span class="hljs-string">&#x27;href&#x27;</span>)<br>        Link.append(a)<br>        <span class="hljs-comment"># print(a)</span><br><br>    data1 = [Order, Title, Up, Click, View, Link]<br>    data2 = each_Data(Link)<br><br>    saveData(data1, data2)  <span class="hljs-comment"># 保存数据</span><br>    driver.quit()  <span class="hljs-comment"># 关闭浏览器</span><br><br>def saveData(data1, data2):<br>    result =&#123;<br>        <span class="hljs-string">&quot;序号&quot;</span>: data1[0],<br>        <span class="hljs-string">&quot;标题&quot;</span>: data1[1],<br>        <span class="hljs-string">&quot;Up主&quot;</span>: data1[2],<br>        <span class="hljs-string">&quot;播放量&quot;</span>: data1[3],<br>        <span class="hljs-string">&quot;评论数&quot;</span>: data1[4],<br>        <span class="hljs-string">&quot;视频链接&quot;</span>: data1[5],<br>        <span class="hljs-string">&quot;点赞数&quot;</span>: data2[0],<br>        <span class="hljs-string">&quot;投币数&quot;</span>: data2[1],<br>        <span class="hljs-string">&quot;收藏数&quot;</span>: data2[2],<br>        <span class="hljs-string">&quot;转发数&quot;</span>: data2[3]<br>    &#125;<br>    <span class="hljs-comment"># 导入数据</span><br>    <span class="hljs-built_in">df</span> = pd.DataFrame(result)<br>    <span class="hljs-comment"># 获取时间</span><br>    now = time.localtime()<br>    now = time.strftime(<span class="hljs-string">&quot;%Y-%m-%d-%H-%M&quot;</span>, now)<br>    <span class="hljs-comment"># 声明文件名称</span><br>    csv_name=<span class="hljs-string">&quot;BilibiliTop100&quot;</span>+now+<span class="hljs-string">&quot;.csv&quot;</span><br>    df.to_csv(csv_name, encoding=<span class="hljs-string">&quot;utf_8_sig&quot;</span>)<br><br>def each_Data(Link):<br>    Like = []   <span class="hljs-comment"># 点赞数</span><br>    Coin = []   <span class="hljs-comment"># 投币数</span><br>    Collect = []    <span class="hljs-comment"># 收藏数</span><br>    Share = []  <span class="hljs-comment"># 转发数</span><br>    driver = webdriver.Chrome(executable_path=r<span class="hljs-string">&quot;C:\Users\丑丑a\Downloads\chromedriver.exe&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(0,100):<br>        <span class="hljs-comment"># 声明爬取网站</span><br>        driver.get(Link[i])<br><br>        like = driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;arc_toolbar_report&quot;]/div[1]/span[1]&#x27;</span>)<br>        like = like.text<br><br>        coin = driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;arc_toolbar_report&quot;]/div[1]/span[2]&#x27;</span>)<br>        coin = coin.text<br><br>        collect = driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;arc_toolbar_report&quot;]/div[1]/span[3]&#x27;</span>)<br>        collect = collect.text<br><br>        share = driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;arc_toolbar_report&quot;]/div[1]/span[4]&#x27;</span>)<br>        share = share.text<br>        Like.append(like)<br>        Coin.append(coin)<br>        Collect.append(collect)<br>        Share.append(share)<br><br>    data = [Like, Coin, Collect, Share]<br>    <span class="hljs-comment"># print(data)</span><br>    driver.quit()<br>    <span class="hljs-built_in">return</span> data<br><br><span class="hljs-keyword">if</span> __name__ ==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>结果：<br><img src="https://i.postimg.cc/2ypXDF5p/result.png" alt="result"></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
